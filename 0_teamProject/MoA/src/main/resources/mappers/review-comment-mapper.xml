<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="edu.og.moa.board.review.model.dao.ReviewBoardCommentMapper">

  <!-- 댓글 목록 조회 -->
  <select id="selectCommentList" parameterType="int" resultType="edu.og.moa.board.review.model.dto.ReviewComment">
    SELECT
        C.COMMENT_NO,
        C.BOARD_NO,
        C.MEMBER_NO,
        C.COMMENT_CONTENT,
        TO_CHAR(C.C_CREATE_DATE, 'YYYY-MM-DD HH24:MI:SS') AS CREATE_DATE,
        C.COMMENT_DEL_FL,
        M.MEMBER_NICKNAME,
        M.PROFILE_IMG
    FROM "COMMENT" C
    JOIN "MEMBER" M ON C.MEMBER_NO = M.MEMBER_NO
    WHERE C.BOARD_NO = #{boardNo}
      AND C.COMMENT_DEL_FL = 'N'
    ORDER BY C.COMMENT_NO DESC
  </select>

  <!-- 댓글 등록 -->
  <insert id="insertComment" parameterType="edu.og.moa.board.review.model.dto.ReviewComment">
    <selectKey keyProperty="commentNo" resultType="int" order="BEFORE">
      SELECT SEQ_COMMENT_NO.NEXTVAL FROM DUAL
    </selectKey>
    INSERT INTO "COMMENT" (
        COMMENT_NO, BOARD_NO, MEMBER_NO, COMMENT_CONTENT, C_CREATE_DATE, COMMENT_DEL_FL
    ) VALUES (
        #{commentNo}, #{boardNo}, #{memberNo}, #{commentContent}, SYSDATE, 'N'
    )
  </insert>

  <!-- 댓글 수정 -->
  <update id="updateComment" parameterType="edu.og.moa.board.review.model.dto.ReviewComment">
    UPDATE "COMMENT"
    SET COMMENT_CONTENT = #{commentContent}
    WHERE COMMENT_NO = #{commentNo}
      AND MEMBER_NO = #{memberNo}
  </update>

  <!-- 댓글 삭제 -->
  <update id="deleteComment" parameterType="edu.og.moa.board.review.model.dto.ReviewComment">
    UPDATE "COMMENT"
    SET COMMENT_DEL_FL = 'Y'
    WHERE COMMENT_NO = #{commentNo}
      AND MEMBER_NO = #{memberNo}
  </update>

</mapper>
