<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="edu.og.moa.board.csboard.model.dao.CsMapper">



   	<!-- Board DTO에 대한 resultMap -->
   	<!-- type="Board" : mybatis-config.xml에 지정한 별칭 -->
   <resultMap type="edu.og.moa.board.csboard.model.dto.BoardJtw" id="board_rm">
   
      <id property="boardNo" column="BOARD_NO"/>
      
      <result property="boardTitle" column="BOARD_TITLE"/>
      <result property="boardContent" column="BOARD_CONTENT"/>
      <result property="boardCreateDate" column="B_CREATE_DATE"/>
      <result property="boardUpdateDate" column="B_UPDATE_DATE"/>
      <result property="boardCount" column="BOARD_COUNT"/>
      <result property="boardDelFl" column="BOARD_DEL_FL"/>
      
      <result property="memberNo" column="MEMBER_NO"/>
      <result property="communityCode" column="COMMUNITY_CODE"/>
      
      <result property="qCode" column="Q_CODE"/>
      
      <result property="communityName" column="COMMUNITY_NAME"/>
      <result property="qName" column="Q_NAME"/>
      
      <!-- 
         collection 태그  
       - select로 조회된 결과를 컬렉션(List)에 담아 지정된 필드에 세팅 
       - property : List를 담을 DTO 필드명
       - select    : 실행할 select의 id
       - column   : 조회 결과 중 지정된 컬럼의 값을 파라미터로 전달
       - javaType : List(컬렉션)의 타입 지정
       - ofType   : List(컬렉션)의 제네릭(타입 제한) 지정
      -->
      <collection property="imageList"
               select="selectImageList"
               column="BOARD_NO"
               javaType="java.util.ArrayList"
               ofType="BoardImage">
      </collection>
      
      <collection property="commentList"
               select="selectCommentList"
               column="BOARD_NO"
               javaType="java.util.ArrayList"
               ofType="Comment">
      </collection>
      
      
   </resultMap>
   
   
   <resultMap type="edu.og.moa.board.csboard.model.dto.Question" id="question_rm">
   
      <id property="qCode" column="Q_CODE"/>
      
      <result property="qName" column="Q_NAME"/>
	
   </resultMap>

	<!-- 삭제되지 않은 게시글 수 -->
	<select id="getListCount">
		SELECT COUNT(*)
		FROM BOARD
		WHERE COMMUNITY_CODE = #{communityCode}
		AND Q_CODE = #{qCode}
		AND BOARD_DEL_FL = 'N'
	
	</select>
	
	
	<!-- 내 문의 게시판 유형 조회 -->
	<select id="selectQCodeList" parameterType="edu.og.moa.board.csboard.model.dto.Question" resultMap="question_rm">
	
		SELECT Q_CODE, Q_NAME FROM QUESTION
	
	</select>
	
	
	<!-- 내 문의 목록 조회 -->
	<select id="selectQuestionList" parameterType="edu.og.moa.board.csboard.model.dto.BoardJtw" resultMap="board_rm">
		SELECT B.BOARD_NO, B.BOARD_TITLE, B.BOARD_CONTENT, B.B_CREATE_DATE, B.B_UPDATE_DATE, B.BOARD_COUNT, B.BOARD_DEL_FL, MEMBER_NO, B.COMMUNITY_CODE, B.Q_CODE, Q.Q_NAME AS qName
		FROM BOARD B
		JOIN QUESTION Q ON B.Q_CODE = Q.Q_CODE
		WHERE B.BOARD_DEL_FL='N'
		AND B.COMMUNITY_CODE = #{communityCode}
		AND B.Q_CODE = #{qCode}
	ORDER BY B.BOARD_NO DESC
	
	</select>
  
</mapper>
