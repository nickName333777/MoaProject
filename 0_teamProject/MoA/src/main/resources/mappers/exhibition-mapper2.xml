<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.og.moa.board.exhibition.model.dao.ExhibitionMapper2">


	<!-- BoardImg DTO에 대한 resultMap -->
	<resultMap type="BoardImgDB" id="boardImg_rm">
		<id property="imgNo" column="IMG_NO" />

		<result property="boardNo" column="BOARD_NO" />
		<result property="imgPath" column="IMG_PATH" />
		<result property="imgOrig" column="IMG_ORIG" />
		<result property="imgRename" column="IMG_RENAME" />
		<result property="imgOrder" column="IMG_ORDER" />
	</resultMap>





	<!-- GENRE DTO에 대한 resultMap -->
	<resultMap type="GenreDB" id="genre_rm">
		<id property="genreNo" column="GENRE_NO" />

		<result property="genreName" column="GENRE_NAME" />
	</resultMap>

	<!-- Institution DTO에 대한 resultMap -->
	<resultMap type="InstitutionDB" id="institution_rm">
		<id property="institutionNo" column="INSTITUTION_NO" />

		<result property="exhibitInstName" column="EXHIBIT_INST_NAME" />
		<result property="exhibitInstTel" column="EXHIBIT_INST_TEL" />
		<result property="exhibitLocation" column="EXHIBIT_LOCATION" />
	</resultMap>
	
	
	<!-- Author DTO에 대한 resultMap -->
	<resultMap type="AuthorDB" id="author_rm">
		<id property="authorNo" column="AUTHOR_NO" />

		<result property="authorName" column="AUTHOR_NAME" />
		<result property="boardNo" column="BOARD_NO" />
	</resultMap>
	
	
	<!-- Like DTO에 대한 resultMap -->
	<resultMap type="LikeDB" id="like_rm">
		<id property="boardNo" column="BOARD_NO" />
		<id property="memberNo" column="MEMBER_NO" />
	</resultMap>
	
	
	<!-- Contributor DTO에 대한 resultMap -->
	<resultMap type="ContributorDB" id="contributor_rm">
		<id property="contributorNo" column="CONTRIBUTOR_NO" />

		<result property="exhibitHost" column="EXHIBIT_HOST" />
		<result property="exhibitSupport" column="EXHIBIT_SUPPORT" />
		<result property="boardNo" column="BOARD_NO" />
	</resultMap>
	
	
	<!-- Board DTO에 대한 resultMap -->
	<resultMap type="BoardDB" id="board_rm">
		<id property="boardNo" column="BOARD_NO" />

		<result property="boardTitle" column="BOARD_TITLE" />
		<result property="boardContent" column="BOARD_CONTENT" />
		<result property="bCreateDate" column="B_CREATE_DATE" />
		<result property="bUpdateDate" column="B_UPDATE_DATE" />
		<result property="boardCount" column="BOARD_COUNT" />
		<result property="boardDelFl" column="BOARD_DEL_FL" />
		<result property="memberNo" column="MEMBER_NO" />
		<result property="communityCode" column="COMMUNITY_CODE"/>
		<result property="qCode" column="Q_CODE"/>
	</resultMap>
	
	
		<!-- Exhibition DTO에 대한 resultMap -->
	<resultMap type="ExhibitionDB" id="exhibition_rm">
		<id property="boardNo" column="BOARD_NO" />

		<result property="exhibitSubTitle" column="EXHIBIT_SUB_TITLE" />
		<result property="exhibitSite" column="EXHIBIT_SITE" />
		<result property="exhibitDate" column="EXHIBIT_DATE" />
		<result property="exhibitContact" column="EXHIBIT_CONTACT" />
		<result property="exhibitAudience" column="EXHIBIT_AUDIENCE" />
		<result property="exhibitCharge" column="EXHIBIT_CHARGE" />
		<result property="institutionNo" column="INSTITUTION_NO" />
		<result property="genreNo" column="GENRE_NO" />
	</resultMap>
	
	
		
<!-- ###################################################################### -->

	<!--  genreName의 genreNo 갯수 세기: 있으면 1, 없으면 0 -->
	<select id="genreSelectCount" resultType="_int">
		SELECT COUNT(GENRE_NO) 
		FROM GENRE
		WHERE GENRE_NAME = #{genreName}
	</select>

	<!-- exhibition 새게시글 데이터 GENRE 테이블에 insert:  -->
	<insert id="genreInsert" parameterType="GenreDB" useGeneratedKeys="true"> 
	    <selectKey resultType="_int" keyProperty="genreNo" order="BEFORE">
	        SELECT SEQ_GENRE_NO.NEXTVAL FROM DUAL
	    </selectKey>		
		INSERT INTO GENRE (
        	GENRE_NO, GENRE_NAME
    	) VALUES(#{genreNo}, #{genreName})
	</insert>	


	<!--  exhibitInstName의 institutionNo 갯수 세기: 있으면 1, 없으면 0 -->
	<select id="institutionSelectCount" resultType="_int">
		SELECT COUNT(INSTITUTION_NO) 
		FROM INSTITUTION
		WHERE EXHIBIT_INST_NAME = #{exhibitInstName}
	</select>

	<!-- exhibition 새게시글 데이터 INSTITUTION 테이블에 insert:  -->
	<insert id="institutionInsert" parameterType="InstitutionDB" useGeneratedKeys="true"> 
	    <selectKey resultType="_int" keyProperty="institutionNo" order="BEFORE">
	        SELECT SEQ_INSTITUTION_NO.NEXTVAL FROM DUAL
	    </selectKey>		
		INSERT INTO INSTITUTION (
        	INSTITUTION_NO, EXHIBIT_INST_NAME, EXHIBIT_INST_TEL
    	) VALUES(#{institutionNo}, #{exhibitInstName}, #{exhibitInstTel})
	</insert>
	
	
	
	
	<!-- 게시글 삭제 by update BOARD_DEL_FL--> 
	<update id="exhibitionDelete">
		UPDATE BOARD SET
		BOARD_DEL_FL = 'Y'
		WHERE BOARD_NO = #{exhibitNo} -- exhibitionNo
	</update>		
	
	
	
	<!-- 게시글 수정 -->
	<update id="updateBoardDB"> 
		UPDATE BOARD SET
		BOARD_TITLE = #{boardTitle},
		BOARD_CONTENT =	#{boardContent},
		B_CREATE_DATE = TO_DATE(#{bCreateDate}, 'YYYY-MM-DD HH24:MI:SS'),	
		B_UPDATE_DATE = SYSDATE
		WHERE BOARD_NO = #{boardNo} -- boardNo 말고, exhibitNo넣어야 함
	</update>
	
	
	<!--  이미지 리스트 일때 update: 이미지하나 전시의 경우 working-->	
	<update id="updateBoardImgDBList">
	    <foreach collection="uploadList" item="img" separator=";">
	        UPDATE BOARD_IMG SET
	            IMG_PATH = #{img.imgPath},
	            IMG_RENAME = #{img.imgRename},
	            IMG_ORIG = #{img.imgOrig}
	        WHERE BOARD_NO = #{img.boardNo}
	          AND IMG_ORDER = #{img.imgOrder}
	    </foreach>
	</update>	
	
		
	<!-- 장르 GENRE 수정:	 -->
	<update id="updateGenreDB">
		UPDATE GENRE SET
        GENRE_NAME = #{genreName}
		WHERE GENRE_NO = #{genreNo}	
	</update>	
	
	<!-- 전시기관INSTITUTION (InstitutionDB) 수정 -->
	<update id="updateInstitutionDB">
		UPDATE INSTITUTION SET 
        EXHIBIT_INST_NAME = #{exhibitInstName}, 
        EXHIBIT_INST_TEL = #{exhibitInstTel}
    	WHERE INSTITUTION_NO = #{institutionNo}	
	</update>		
	
	<!-- EXHIBITION (ExhibitionDB) 수정:  -->
	<update id="updateExhibitionDB">
		UPDATE EXHIBITION SET    	
       	EXHIBIT_SUB_TITLE = #{exhibitSubTitle}, 
       	EXHIBIT_SITE = #{exhibitSite}, 
       	EXHIBIT_DATE = #{exhibitDate},
       	EXHIBIT_CONTACT = #{exhibitContact}, 
       	EXHIBIT_AUDIENCE = #{exhibitAudience}, 
        EXHIBIT_CHARGE = #{exhibitCharge}, 
        INSTITUTION_NO = #{institutionNo}, 
        GENRE_NO = #{genreNo}
        WHERE BOARD_NO = #{boardNo}
	</update>		

	<!-- AUTHOR (AuthorDB) 수정: (List:NG):  -->
	<update id="updateAuthorDBList" parameterType="java.util.List">
	    <foreach collection="list" item="author" separator=";">
	        UPDATE AUTHOR
	        SET AUTHOR_NAME = #{author.authorName}
	        WHERE BOARD_NO = #{author.boardNo}
	    </foreach>
	</update>
	
	
	<!-- 특정 게시글  AuthorNo 조회: 명시적 select수행 -->
   	<select id="selectAuthorNo" resultMap="author_rm">
      SELECT AUTHOR_NO FROM "AUTHOR"
      WHERE BOARD_NO = #{boardNo}
      ORDER BY AUTHOR_NO 
   	</select>
   		
   <!-- 특정 게시글  Author List 조회: 명시적 select수행 -->		
   	<select id="selectAuthorListAll" resultMap="author_rm">
      SELECT * FROM "AUTHOR"
      WHERE BOARD_NO = #{boardNo}
      ORDER BY AUTHOR_NO 
   	</select>
	
	<!-- AUTHOR (AuthorDB) 수정(single Author):  -->
	<update id="updateAuthorInDB" parameterType="AuthorDB">
	    UPDATE AUTHOR SET AUTHOR_NAME = #{authorName}
	    WHERE BOARD_NO = #{boardNo}
	    AND AUTHOR_NO = #{authorNo}
	</update>
	<!-- AND AUTHOR_NO = #{authorNo} -->
	
   <!-- 특정 게시글  Author 삭제-->		
   	<delete id="deleteAuthorInDB">
      DELETE FROM "AUTHOR"
      WHERE BOARD_NO = #{boardNo}
      AND AUTHOR_NO = #{authorNo}
   	</delete>
	
   <!-- 특정 게시글  추가 Author 삽입-->		
   	<insert id="insertAuthorInDB" parameterType="AuthorDB">
      INSERT INTO "AUTHOR" (
        	AUTHOR_NO, 
        	AUTHOR_NAME, BOARD_NO
    	) VALUES( SEQ_AUTHOR_NO.NEXTVAL,  
    			#{authorName}, #{boardNo} )
   	</insert>		
	
	<!-- CONTRIBUTOR (ContributorDB) 수정:  -->
	<update id="updateContributorDB">
		UPDATE "CONTRIBUTOR" SET 
        EXHIBIT_HOST = #{exhibitHost}, 
        EXHIBIT_SUPPORT = #{exhibitSupport}
        WHERE BOARD_NO = #{boardNo}
	</update>	
	

</mapper>
