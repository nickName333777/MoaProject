<!DOCTYPE html>
<html lang="en" xmlns="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.min.js"
        integrity="sha384-G/EV+4j2dNv+tEPo3++6LCgdCROaejBqfUeNjuKAiuXbjrxilcCdDz6ZAVfHWe1Y"
        crossorigin="anonymous"></script>

    <!-- <script th:src="@{https://kit.fontawesome.com/f7459b8054.js}" crossorigin="anonymous"></script> -->
    <script src="https://kit.fontawesome.com/f7459b8054.js" crossorigin="anonymous"></script>

    <!-- ë¨¼ì € CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

    <!-- ê·¸ ë‹¤ìŒ JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ko.js"></script>

    <!-- ì„ì‹œ -->
    <link th:href="@{/css/main-style.css}" rel="stylesheet" />
    <!-- ì„ì‹œ -->
    <link rel="stylesheet" th:href="@{/css/board/performance/pm-detail-style.css}">
    <title>Document</title>
</head>

<body>
    <th:block th:replace="~{/common/header}">header.html</th:block>

    <main>

        <section id="main-container" th:object="${board}">

            <!-- ë’¤ë¡œê°€ê¸° -->
            <div id="back-btn" onclick="history.back()">
                <i class="fa-solid fa-arrow-left"></i> ë’¤ë¡œê°€ê¸°
            </div>

            <!-- ìƒë‹¨ ìƒì„¸ì •ë³´ ê³µê°„ -->
            <table id="detail-content">

                <!-- ì¸ë„¤ì¼ í¬ìŠ¤í„° -->
                <tr id="detail-title">

                    <td rowspan="6" width="400px" height="533px" id="detail-title-poster">
                        <img th:src="${thumbnail.imgPath}">
                        <!-- <img src="http://www.kopis.or.kr/upload/pfmPoster/PF_PF275265_250929_145553.gif" alt=""> -->
                    </td>

                    <!-- ì œëª© -->
                    <td colspan="3" width="630px" height="130px">
                        <h3 th:text="*{boardTitle}">ì œ5íšŒ ì½”ë„ë ˆì›€ ì¸ ì„œìš¸ ì—°ì£¼íšŒ: í•©ì°½ëª…ì‘ ë§ˆì£¼í•˜ê¸° í”„ë¡œì íŠ¸ V. ë°”í & í—¨ë¸ íƒ„ìƒ 340ì£¼ë…„ ê¸°ë…, ì¡°ìš°: ë°”ë¡œí¬
                            ë™ê°‘ë‚´ê¸° ê±°ì¥ì„ ë§Œë‚˜ë‹¤</h3>
                    </td>
                </tr>

                <!-- ì¥ì†Œ -->
                <tr id="detail-place">
                    <td width="" height="60px">
                        ê³µì—° ì¥ì†Œ
                    </td>

                    <td width="" colspan="2">
                        <div th:text="*{pmHouseName}">ê³µì—° ì¥ì†Œ</div>
                    </td>
                </tr>

                <!-- ê¸°ê°„ -->
                <tr id="detail-date">
                    <td width="120px" height="60px">
                        ê³µì—° ê¸°ê°„
                    </td>
                    <!-- th:text="|[${board.commentCount}]|" -->
                    <td width="" colspan="2">
                        <div th:text="|${board.pmStartTime} ~ ${board.pmEndTime}|">ê³µì—° ê¸°ê°„</div>
                    </td>
                </tr>

                <!-- ì‹œê°„ -->
                <tr id="detail-time">
                    <td width="" height="60px">ê³µì—° ì‹œê°„</td>
                    <td colspan="2">
                        <div th:text="*{pmPlaytime}">ê³µì—° ì‹œê°„</div>
                    </td>
                </tr>

                <!-- ê°€ê²© -->
                <tr id="detail-price">
                    <td width="" height="140px" rowspan="2">
                        ì¢Œì„ ê°€ê²©
                    </td>

                    <td rowspan="2" colspan="2">

                        <!-- ê°œìˆ˜ë§Œí¼ ë°˜ë³µ -->
                        <div class="priceList" th:each="price : ${board.pmPriceList}">
                            <th:block th:text="|${price.pmPriceType} - ${price.pmPrice}ì›|">ì¢Œì„</th:block>
                        </div>

                    </td>
                </tr>

            </table>

            <!-- íƒ­ ë©”ë‰´ -->
            <!-- ë‹¨ìˆœ ë„¤ë¹„ê²Œì´ì…˜ ì—­í•  -->
            <ul class="detail-nav nav nav-tabs" id="myTab" role="tablist">

                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="poster-tab" data-bs-toggle="tab"
                        data-bs-target="#poster-tab-pane" type="button" role="tab" aria-controls="poster-tab-pane"
                        aria-selected="true">í¬ìŠ¤í„°</button>
                </li>

                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="comment-tab" data-bs-toggle="tab" data-bs-target="#comment-tab-pane"
                        type="button" role="tab" aria-controls="comment-tab-pane" aria-selected="false">
                        ê¸°ëŒ€í‰ <th:block th:text="|(${board.commentCount})|">(ìˆ«ì)</th:block>
                    </button>
                </li>

                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#contact-tab-pane"
                        type="button" role="tab" aria-controls="contact-tab-pane" aria-selected="false"
                        onclick="resizeMap(); relayout();">ì˜¤ì‹œëŠ” ê¸¸</button>
                </li>

                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="review-tab" data-bs-toggle="tab" data-bs-target="#review -tab-pane"
                        type="button" role="tab" aria-controls="review-tab-pane" aria-selected="false">ê´€ë ¨ í›„ê¸°</button>
                </li>

            </ul>

            <!-- íƒ­ ì»¨í…ì¸  -->
            <!-- ë„¤ë¹„ê²Œì´ì…˜ê³¼ ì—°ë™ëœ ë³¸ë¬¸ ë¶€ë¶„ -->
            <div class="tab-content" id="myTabContent">

                <!-- í¬ìŠ¤í„° ë¶€ë¶„ íƒ­ ë‚´ìš© -->
                <div class="tab-pane fade show active" id="poster-tab-pane" role="tabpanel" aria-labelledby="poster-tab"
                    tabindex="0">
                    <div class="poster-box">
                        <th:block th:each="i : ${#numbers.sequence(0, #lists.size(board.pmImageList)-1,1)}">
                            <img th:src="${board.pmImageList[i].imgPath}">
                        </th:block>
                    </div>
                </div>

                <!-- ê¸°ëŒ€í‰ ë¶€ë¶„ íƒ­ ë‚´ìš© -->
                <div class="tab-pane fade" id="comment-tab-pane" role="tabpanel" aria-labelledby="comment-tab"
                    tabindex="0">
                    <p>ê¸°ëŒ€í‰ë“¤ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                </div>

                <!-- ì˜¤ì‹œëŠ” ê¸¸ ë¶€ë¶„ íƒ­ ë‚´ìš© -->
                <div class="tab-pane fade" id="contact-tab-pane" role="tabpanel" aria-labelledby="contact-tab"
                    tabindex="0">
                    <th:block th:replace="~{/board/performance/tab/pm-detail-map}">ì˜¤ì‹œëŠ”ê¸¸.html</th:block>
                </div>

                <!-- ê´€ë ¨ í›„ê¸° íƒ­ ë‚´ìš© -->
                <div class="tab-pane fade" id="review-tab-pane" role="tabpanel" aria-labelledby="review-tab"
                    tabindex="0">
                    ë¦¬ë·°ê²Œì‹œíŒì—
                </div>
            </div>


        </section>

        <section id="calendar-container">

            <!-- ê²°ì¬í•  ë•Œ ë„˜ì–´ê°ˆ ì •ë³´ë“¤ -->
            <form th:action="@{/payment/pay}" method="post">
                <input type="hidden" name="boardNo" th:value="${board.boardNo}" />
                <input type="hidden" name="showTitle" th:value="${board.boardTitle}" />
                <input type="hidden" name="showName" th:value="${board.boardTitle}" />

                <!-- ì„ì‹œ ê³µì—° ë‚ ì§œ -->
                <input type="hidden" id="showDate" name="showDate" th:value="${board.pmStartTime}" />

                <input type="hidden" name="showPlace" th:value="${board.pmHouseName}" />
                <input type="hidden" name="memberNo" th:value="${session.loginMember?.memberNo}" />
                <input type="hidden" name="memberNickname" th:value="${session.loginMember?.memberNickname}" />
                <input type="hidden" name="memberTel" th:value="${session.loginMember?.memberTel}" />
                <input type="hidden" name="memberEmail" th:value="${session.loginMember?.memberEmail}" />
                <input type="hidden" name="eventType" th:value="'performance'" />

                <!-- ì¢Œì„ ë¶„ë¥˜ ë° ê°€ê²© ë°˜ë³µë¬¸ -->
                <th:block th:each="price, iterStat : ${board.pmPriceList}">
                    <input type="hidden" th:name="|priceList[${iterStat.index}].pmPriceType|" th:value="${price.pmPriceType}" />
                    <input type="hidden" th:name="|priceList[${iterStat.index}].pmPrice|" th:value="${price.pmPrice}" />
                </th:block>

                <!-- ë‚ ì§œ ì„ íƒìš© ë‹¬ë ¥ ë“¤ì–´ê°ˆ ìë¦¬ -->
                <div id="calendar" class="calendar"></div>


                <button id="pm-buy-btn">ì˜ˆë§¤í•˜ê¸°</button>
            </form>


            <span class="like-area">
                <!-- <i class="fa-heart" th:classappend="${likeCheck} ? 'fa-solid' : 'fa-regular'" id="boardLike"></i> -->

                <!-- ëª¨ì–‘ì¡ê¸°ìš© ì„ì‹œ í•˜íŠ¸ -->
                <i class="fa-heart" th:classappend="${likeCheck} ? 'fa-solid' : 'fa-regular'" id="boardLike"></i>
                <!-- ==> ì‚¼í•­ì—°ì‚°ì == likeCheckì˜ ê°’ì´ ìˆìœ¼ë©´ fa-solidê°€, ì—†ìœ¼ë©´ fa-regularê°€ í´ë˜ìŠ¤ì— ì¶”ê°€ë¨ -->
                <span th:text="*{likeCount}">ì¢‹ì•„ìš” ìˆ˜</span>
            </span>

        </section>
    </main>








    <th:block th:replace="~{/common/footer}">footer.html</th:block>

    <script th:inline="javascript">
        document.addEventListener("DOMContentLoaded", function () {
            const calendarElem = document.getElementById("calendar");
            const showDateInput = document.getElementById("showDate");

            if (!calendarElem) {
                console.error("âš ï¸ #calendar ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");
                return;
            }

            // ê³µì—° ì‹œì‘/ì¢…ë£Œì¼ (ì„œë²„ì—ì„œ ë„˜ì–´ì˜¨ Thymeleaf ê°’)
            const startRaw = /*[[${board.pmStartTime}]]*/ "2025.12.25";
            const endRaw = /*[[${board.pmEndTime}]]*/ "2025.12.27";

            if (!startRaw || !endRaw) {
                console.warn("âš ï¸ ê³µì—° ë‚ ì§œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¬ë ¥ ë Œë”ë§ ìƒëµ.");
                return;
            }

            // ë¬¸ìì—´ì„ Date ê°ì²´ë¡œ ë³€í™˜ ('.' êµ¬ë¶„ì â†’ ì¸ì‹ ê°€ëŠ¥ í˜•íƒœë¡œ êµì²´)
            const startDate = new Date(startRaw.replace(/\./g, '-'));
            const endDate = new Date(endRaw.replace(/\./g, '-'));

            // í•œêµ­ì–´ ë¡œì¼€ì¼ ì ìš©
            flatpickr.localize(flatpickr.l10ns.ko);

            // ë‹¬ë ¥ ì´ˆê¸°í™”
            flatpickr(calendarElem, {
                inline: true,
                dateFormat: "Y-m-d",
                minDate: startDate,
                maxDate: endDate,
                defaultDate: startDate,
                disable: [
                    function (date) {
                        return date < new Date(startDate) || date > new Date(endDate);
                    }
                ],
                onChange: function (selectedDates, dateStr) {
                    showDateInput.value = dateStr;
                    console.log("ğŸ« ì„ íƒí•œ ê³µì—° ë‚ ì§œ:", dateStr);
                },
                onDayCreate: function (dObj, dStr, fp, dayElem) {
                    // ê³µì—° ê¸°ê°„ ë‚´ ë‚ ì§œëŠ” ì§„í•˜ê²Œ í‘œì‹œ
                    const date = dayElem.dateObj;
                    const s = new Date(startDate);
                    const e = new Date(endDate);
                    if (date >= s && date <= e) {
                        dayElem.style.backgroundColor = "#e3f2fd";
                    } else {
                        dayElem.style.opacity = "0.3";
                        dayElem.style.pointerEvents = "none";
                    }
                }
            });
        });


        const loginMemberNo = /*[[${session.loginMember?.memberNo}]]*/ "ë¡œê·¸ì¸í•œ íšŒì› ë²ˆí˜¸";
        // ==> session.loginMember ì˜ ê°’ì´ ì—†ìœ¼ë©´ ì˜¤ë¥˜ë‚˜ë‹ˆê¹Œ ?. ìœ¼ë¡œ ê°ì²´ê°€ nullì¸ì§€ íƒìƒ‰(í™•ì¸)í•´ì„œ nullì´ ì•„ë‹ ê²½ìš° í•„ë“œ ì ‘ê·¼
        
        const memberNickname = /*[[${session.loginMember?.memberNickname}]]*/ "ë¡œê·¸ì¸í•œ íšŒì› ë‹‰ë„¤ì„";

        // ==> ë§Œì•½ ë¡œê·¸ì¸í•œ íšŒì›ì˜ ë²ˆí˜¸ê°€ ì—†ë‹¤ë©´ ë¹ˆì¹¸ì„ ì§‘ì–´ë„£ê² ë‹¤
        if (loginMemberNo == null) loginMemberNo = "";

        const boardNo = /*[[${board.boardNo}]]*/ 'ê²Œì‹œê¸€ ë²ˆí˜¸';


        const boardTitle = /*[[${board.boardTitle}]]*/ 'ê²Œì‹œê¸€ ì œëª©';
    </script>
    <script th:src="@{/js/board/performance/pm-detail.js}"></script>
</body>

</html>